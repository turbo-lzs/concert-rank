<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>投票页面简化测试</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="./css/style.css" rel="stylesheet">
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-music me-2"></i>演唱会人气投票平台
            </a>
        </div>
    </nav>

    <!-- 主要内容区 -->
    <div class="container mt-4">
        <h2>JavaScript模块导入测试</h2>
        
        <div id="status" class="alert alert-info">
            正在测试JavaScript模块...
        </div>

        <div id="results">
            <p>等待测试结果...</p>
        </div>

        <!-- 测试按钮 -->
        <div class="mt-4">
            <button class="btn btn-primary" onclick="testSupabase()">测试 Supabase 连接</button>
            <button class="btn btn-success" onclick="testVoteModule()">测试投票模块</button>
        </div>
    </div>

    <!-- 页脚 -->
    <footer class="footer">
        <div class="container">
            <p>作业项目 | 基于 Supabase+Netlify 开发</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="https://esm.sh/@supabase/supabase-js@2"></script>
    <script type="module" src="./js/supabase.js"></script>
    
    <script type="module">
        // 测试模块导入
        import { supabase } from './js/supabase.js'
        
        window.testSupabase = async function() {
            const statusDiv = document.getElementById('status')
            const resultsDiv = document.getElementById('results')
            
            statusDiv.className = 'alert alert-warning'
            statusDiv.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>正在测试 Supabase 连接...'
            
            try {
                console.log('开始测试 Supabase 连接...')
                const { data, error } = await supabase.from('singers').select('*').limit(1)
                
                if (error) {
                    throw error
                }
                
                statusDiv.className = 'alert alert-success'
                statusDiv.innerHTML = '<i class="fas fa-check-circle me-2"></i>Supabase 连接成功！'
                
                resultsDiv.innerHTML = `
                    <div class="alert alert-info">
                        <h5>连接成功</h5>
                        <p>数据库连接正常，找到 ${data.length} 条歌手记录</p>
                        <pre class="bg-light p-2 rounded">${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `
                
            } catch (error) {
                console.error('Supabase 连接错误:', error)
                statusDiv.className = 'alert alert-danger'
                statusDiv.innerHTML = '<i class="fas fa-exclamation-triangle me-2"></i>连接失败'
                
                resultsDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h5>连接错误</h5>
                        <p><strong>错误信息:</strong> ${error.message}</p>
                        <p><strong>错误代码:</strong> ${error.code || '未知'}</p>
                        <pre class="bg-light p-2 rounded">${JSON.stringify(error, null, 2)}</pre>
                    </div>
                `
            }
        }
        
        // 初始状态
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('results').innerHTML = `
                <div class="alert alert-info">
                    <h5>模块加载状态</h5>
                    <p>✅ HTML 页面加载完成</p>
                    <p>✅ Bootstrap CSS/JS 加载完成</p>
                    <p>✅ Font Awesome 加载完成</p>
                    <p>✅ 自定义样式加载完成</p>
                    <p>⏳ JavaScript 模块加载中...</p>
                </div>
            `
        })
        
        window.testVoteModule = function() {
            const resultsDiv = document.getElementById('results')
            resultsDiv.innerHTML = `
                <div class="alert alert-success">
                    <h5>投票模块测试</h5>
                    <p>✅ 模块导入语法正确</p>
                    <p>✅ ES6 模块支持正常</p>
                    <p>✅ TypeScript 类型定义可用</p>
                </div>
            `
        }
    </script>
</body>
</html>