<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片管理 - 陈立农演唱会</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="./css/style.css" rel="stylesheet">
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-music me-2"></i>演唱会人气投票平台
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">人气排名</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="vote.html">我要投票</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="stats.html">统计分析</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- 主要内容区 -->
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title text-center mb-4">
                            <i class="fas fa-images me-2"></i>陈立农演唱会图片管理
                        </h2>
                        
                        <!-- 使用说明 -->
                        <div class="alert alert-info">
                            <h5><i class="fas fa-info-circle me-2"></i>使用说明</h5>
                            <ol class="mb-2">
                                <li>将你的陈立农演唱会图片文件放到 <code>assets/images/</code> 文件夹中</li>
                                <li>确保文件名与下方表格中的"建议文件名"一致</li>
                                <li>支持 JPG、PNG 格式，建议尺寸：头像 100x100px，海报 300x200px</li>
                                <li>放置文件后刷新此页面查看图片预览</li>
                            </ol>
                            <p class="mb-0"><strong>文件夹位置：</strong> <code>d:/A-cumpus/ConcertRank/assets/images/</code></p>
                        </div>

                        <!-- 图片列表 -->
                        <h4 class="mb-3"><i class="fas fa-list me-2"></i>所需图片清单</h4>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th width="120">图片类型</th>
                                        <th width="200">建议文件名</th>
                                        <th width="150">建议尺寸</th>
                                        <th width="250">描述</th>
                                        <th width="300">图片预览</th>
                                        <th>状态</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><i class="fas fa-user-circle text-primary"></i> 头像</td>
                                        <td><code>chenlinong-avatar.jpg</code></td>
                                        <td>100×100px</td>
                                        <td>陈立农个人头像</td>
                                        <td>
                                            <img src="./assets/images/chenlinong-avatar.jpg" 
                                                 alt="陈立农头像" 
                                                 class="img-thumbnail" 
                                                 style="width: 80px; height: 80px; object-fit: cover;"
                                                 onerror="this.src='https://picsum.photos/100/100?random=200'; this.nextElementSibling.innerHTML='未找到文件';">
                                            <small class="d-block text-muted mt-1">✅ 文件存在</small>
                                        </td>
                                        <td><span class="badge bg-success">待上传</span></td>
                                    </tr>
                                    <tr>
                                        <td><i class="fas fa-image text-warning"></i> 海报</td>
                                        <td><code>chenlinong-taipei.jpg</code></td>
                                        <td>300×200px</td>
                                        <td>青春之后 2.0 台北站</td>
                                        <td>
                                            <img src="./assets/images/chenlinong-taipei.jpg" 
                                                 alt="台北站海报" 
                                                 class="img-thumbnail" 
                                                 style="width: 120px; height: 80px; object-fit: cover;"
                                                 onerror="this.src='https://picsum.photos/300/200?random=201'; this.nextElementSibling.innerHTML='未找到文件';">
                                            <small class="d-block text-muted mt-1">✅ 文件存在</small>
                                        </td>
                                        <td><span class="badge bg-success">待上传</span></td>
                                    </tr>
                                    <tr>
                                        <td><i class="fas fa-image text-warning"></i> 海报</td>
                                        <td><code>chenlinong-shanghai.jpg</code></td>
                                        <td>300×200px</td>
                                        <td>青春之后 2.0 上海站</td>
                                        <td>
                                            <img src="./assets/images/chenlinong-shanghai.jpg" 
                                                 alt="上海站海报" 
                                                 class="img-thumbnail" 
                                                 style="width: 120px; height: 80px; object-fit: cover;"
                                                 onerror="this.src='https://picsum.photos/300/200?random=202'; this.nextElementSibling.innerHTML='未找到文件';">
                                            <small class="d-block text-muted mt-1">✅ 文件存在</small>
                                        </td>
                                        <td><span class="badge bg-success">待上传</span></td>
                                    </tr>
                                    <tr>
                                        <td><i class="fas fa-image text-warning"></i> 海报</td>
                                        <td><code>chenlinong-guangzhou.jpg</code></td>
                                        <td>300×200px</td>
                                        <td>青春之后 2.0 广州站</td>
                                        <td>
                                            <img src="./assets/images/chenlinong-guangzhou.jpg" 
                                                 alt="广州站海报" 
                                                 class="img-thumbnail" 
                                                 style="width: 120px; height: 80px; object-fit: cover;"
                                                 onerror="this.src='https://picsum.photos/300/200?random=203'; this.nextElementSibling.innerHTML='未找到文件';">
                                            <small class="d-block text-muted mt-1">✅ 文件存在</small>
                                        </td>
                                        <td><span class="badge bg-success">待上传</span></td>
                                    </tr>
                                    <tr>
                                        <td><i class="fas fa-image text-warning"></i> 海报</td>
                                        <td><code>chenlinong-beijing.jpg</code></td>
                                        <td>300×200px</td>
                                        <td>青春之后 2.0 北京站</td>
                                        <td>
                                            <img src="./assets/images/chenlinong-beijing.jpg" 
                                                 alt="北京站海报" 
                                                 class="img-thumbnail" 
                                                 style="width: 120px; height: 80px; object-fit: cover;"
                                                 onerror="this.src='https://picsum.photos/300/200?random=204'; this.nextElementSibling.innerHTML='未找到文件';">
                                            <small class="d-block text-muted mt-1">✅ 文件存在</small>
                                        </td>
                                        <td><span class="badge bg-success">待上传</span></td>
                                    </tr>
                                    <tr>
                                        <td><i class="fas fa-image text-warning"></i> 海报</td>
                                        <td><code>chenlinong-chengdu.jpg</code></td>
                                        <td>300×200px</td>
                                        <td>青春之后 2.0 成都站</td>
                                        <td>
                                            <img src="./assets/images/chenlinong-chengdu.jpg" 
                                                 alt="成都站海报" 
                                                 class="img-thumbnail" 
                                                 style="width: 120px; height: 80px; object-fit: cover;"
                                                 onerror="this.src='https://picsum.photos/300/200?random=205'; this.nextElementSibling.innerHTML='未找到文件';">
                                            <small class="d-block text-muted mt-1">✅ 文件存在</small>
                                        </td>
                                        <td><span class="badge bg-success">待上传</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- 操作按钮 -->
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <button class="btn btn-primary btn-lg w-100" onclick="openFolder()">
                                    <i class="fas fa-folder-open me-2"></i>打开图片文件夹
                                </button>
                            </div>
                            <div class="col-md-6">
                                <button class="btn btn-success btn-lg w-100" onclick="updateDatabase()">
                                    <i class="fas fa-database me-2"></i>更新数据库图片路径
                                </button>
                            </div>
                        </div>

                        <!-- 操作结果 -->
                        <div id="result" class="mt-4"></div>

                        <!-- 文件夹快捷方式 -->
                        <div class="mt-4 p-3 bg-light rounded">
                            <h5><i class="fas fa-folder me-2"></i>文件夹快捷方式</h5>
                            <p class="mb-2">点击下面的链接快速打开图片文件夹：</p>
                            <div class="input-group">
                                <input type="text" 
                                       class="form-control" 
                                       value="d:/A-cumpus/ConcertRank/assets/images/" 
                                       id="folderPath" 
                                       readonly>
                                <button class="btn btn-outline-secondary" onclick="copyPath()">
                                    <i class="fas fa-copy me-1"></i>复制路径
                                </button>
                            </div>
                        </div>

                        <!-- 快速操作 -->
                        <div class="mt-4">
                            <h5><i class="fas fa-rocket me-2"></i>快速操作</h5>
                            <div class="row">
                                <div class="col-md-4 mb-2">
                                    <a href="add-chenlinong.html" class="btn btn-outline-primary w-100">
                                        <i class="fas fa-plus me-2"></i>添加陈立农数据
                                    </a>
                                </div>
                                <div class="col-md-4 mb-2">
                                    <a href="vote.html" class="btn btn-outline-success w-100">
                                        <i class="fas fa-vote-yea me-2"></i>查看投票页面
                                    </a>
                                </div>
                                <div class="col-md-4 mb-2">
                                    <a href="index.html" class="btn btn-outline-secondary w-100">
                                        <i class="fas fa-home me-2"></i>返回首页
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 页脚 -->
    <footer class="footer">
        <div class="container">
            <p>作业项目 | 基于 Supabase+Netlify 开发</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="https://esm.sh/@supabase/supabase-js@2"></script>
    <script type="module" src="./js/supabase.js"></script>
    
    <script>
        // 打开图片文件夹
        function openFolder() {
            const folderPath = 'd:/A-cumpus/ConcertRank/assets/images/';
            
            // 尝试打开文件夹
            if (typeof require !== 'undefined') {
                // Node.js 环境
                const { shell } = require('electron');
                shell.openPath(folderPath);
            } else {
                // 浏览器环境，显示提示
                showResult('info', '请在文件管理器中打开：' + folderPath);
            }
        }

        // 复制文件夹路径
        function copyPath() {
            const pathInput = document.getElementById('folderPath');
            pathInput.select();
            document.execCommand('copy');
            showResult('success', '文件夹路径已复制到剪贴板！');
        }

        // 更新数据库图片路径
        async function updateDatabase() {
            const button = event.target;
            
            try {
                button.disabled = true;
                button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>正在更新...';
                
                showResult('info', '正在更新数据库中的图片路径...');
                
                // 这里需要导入Supabase模块
                const { supabase, TABLES } = await import('./js/supabase.js');
                
                // 更新歌手头像
                await supabase
                    .from(TABLES.SINGERS)
                    .update({ avatar: './assets/images/chenlinong-avatar.jpg' })
                    .eq('name', '陈立农');
                
                // 更新演唱会海报
                const updates = [
                    { title: '青春之后 2.0 巡回演唱会 - 台北站', poster: './assets/images/chenlinong-taipei.jpg' },
                    { title: '青春之后 2.0 巡回演唱会 - 上海站', poster: './assets/images/chenlinong-shanghai.jpg' },
                    { title: '青春之后 2.0 巡回演唱会 - 广州站', poster: './assets/images/chenlinong-guangzhou.jpg' },
                    { title: '青春之后 2.0 巡回演唱会 - 北京站', poster: './assets/images/chenlinong-beijing.jpg' },
                    { title: '青春之后 2.0 巡回演唱会 - 成都站', poster: './assets/images/chenlinong-chengdu.jpg' }
                ];
                
                for (const update of updates) {
                    await supabase
                        .from(TABLES.CONCERTS)
                        .update({ poster: update.poster })
                        .eq('title', update.title);
                }
                
                showResult('success', '✅ 数据库图片路径更新成功！<br>请刷新投票页面查看效果。');
                
            } catch (error) {
                console.error('更新失败:', error);
                showResult('danger', '❌ 更新失败：' + error.message);
            } finally {
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-database me-2"></i>更新数据库图片路径';
            }
        }

        // 显示操作结果
        function showResult(type, message) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `
                <div class="alert alert-${type} alert-dismissible fade show">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            // 3秒后自动隐藏
            setTimeout(() => {
                resultDiv.innerHTML = '';
            }, 3000);
        }

        // 页面加载完成
        document.addEventListener('DOMContentLoaded', function() {
            console.log('图片管理页面加载完成');
            
            // 检查图片是否存在
            const images = document.querySelectorAll('img');
            images.forEach(img => {
                img.onerror = function() {
                    this.nextElementSibling.innerHTML = '❌ 未找到文件';
                    this.closest('tr').querySelector('.badge').className = 'badge bg-danger';
                    this.closest('tr').querySelector('.badge').textContent = '待上传';
                };
                
                img.onload = function() {
                    this.nextElementSibling.innerHTML = '✅ 文件存在';
                    this.closest('tr').querySelector('.badge').className = 'badge bg-success';
                    this.closest('tr').querySelector('.badge').textContent = '已上传';
                };
            });
        });
    </script>
</body>
</html>