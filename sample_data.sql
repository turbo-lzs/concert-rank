-- 演唱会人气投票平台 - 示例数据SQL文件
-- 请在你的Supabase SQL编辑器中执行此SQL语句

-- 1. 清空现有数据（可选）
-- TRUNCATE TABLE votes, concerts, singers RESTART IDENTITY CASCADE;

-- 2. 插入歌手数据
WITH singer_data AS (
  INSERT INTO singers (name, genre, avatar) VALUES
  ('周杰伦', '流行', 'https://picsum.photos/100/100?random=1'),
  ('林俊杰', '流行', 'https://picsum.photos/100/100?random=2'),
  ('五月天', '摇滚', 'https://picsum.photos/100/100?random=3'),
  ('邓紫棋', '流行', 'https://picsum.photos/100/100?random=4'),
  ('薛之谦', '民谣', 'https://picsum.photos/100/100?random=5'),
  ('华晨宇', '流行', 'https://picsum.photos/100/100?random=6'),
  ('张杰', '流行', 'https://picsum.photos/100/100?random=7'),
  ('陈奕迅', '流行', 'https://picsum.photos/100/100?random=8'),
  ('蔡依林', '流行', 'https://picsum.photos/100/100?random=9'),
  ('Taylor Swift', '流行', 'https://picsum.photos/100/100?random=10')
  RETURNING id, name
)

-- 3. 插入演唱会数据
INSERT INTO concerts (singer_id, title, date, venue, poster)
SELECT 
  s.id,
  concert_data.title,
  concert_data.date::DATE,
  concert_data.venue,
  concert_data.poster
FROM singer_data s
JOIN (
  VALUES
  -- 周杰伦的演唱会
  ('周杰伦', '2024 嘉年华世界巡回演唱会 - 上海站', '2024-08-15', '上海体育场', 'https://picsum.photos/300/200?random=101'),
  ('周杰伦', '2024 嘉年华世界巡回演唱会 - 北京站', '2024-09-20', '北京鸟巢', 'https://picsum.photos/300/200?random=102'),
  ('周杰伦', '2024 嘉年华世界巡回演唱会 - 广州站', '2024-10-10', '广州体育馆', 'https://picsum.photos/300/200?random=103'),
  ('周杰伦', '2024 嘉年华世界巡回演唱会 - 成都站', '2024-11-05', '成都体育中心', 'https://picsum.photos/300/200?random=104'),

  -- 林俊杰的演唱会
  ('林俊杰', 'JJ20 世界巡回演唱会 - 深圳站', '2024-10-05', '深圳湾体育中心', 'https://picsum.photos/300/200?random=105'),
  ('林俊杰', 'JJ20 世界巡回演唱会 - 上海站', '2024-11-12', '梅赛德斯奔驰文化中心', 'https://picsum.photos/300/200?random=106'),
  ('林俊杰', 'JJ20 世界巡回演唱会 - 台北站', '2024-12-01', '台北小巨蛋', 'https://picsum.photos/300/200?random=107'),

  -- 五月天的演唱会
  ('五月天', '好好好想见到你 - 上海站', '2024-11-10', '虹口足球场', 'https://picsum.photos/300/200?random=108'),
  ('五月天', '好好好想见到你 - 北京站', '2024-12-05', '工人体育场', 'https://picsum.photos/300/200?random=109'),
  ('五月天', '好好好想见到你 - 高雄站', '2024-12-25', '高雄世运主场馆', 'https://picsum.photos/300/200?random=110'),

  -- 邓紫棋的演唱会
  ('邓紫棋', 'Queen of Hearts 世界巡回 - 广州站', '2024-12-15', '广州体育馆', 'https://picsum.photos/300/200?random=111'),
  ('邓紫棋', 'Queen of Hearts 世界巡回 - 香港站', '2024-12-20', '香港红磡体育馆', 'https://picsum.photos/300/200?random=112'),

  -- 薛之谦的演唱会
  ('薛之谦', '天外来物巡回演唱会 - 上海站', '2024-09-01', '上海虹口足球场', 'https://picsum.photos/300/200?random=113'),
  ('薛之谦', '天外来物巡回演唱会 - 北京站', '2024-09-15', '北京工人体育场', 'https://picsum.photos/300/200?random=114'),

  -- 华晨宇的演唱会
  ('华晨宇', '火星演唱会 - 上海站', '2024-10-20', '上海梅赛德斯奔驰文化中心', 'https://picsum.photos/300/200?random=115'),
  ('华晨宇', '火星演唱会 - 成都站', '2024-11-08', '成都五粮液演艺中心', 'https://picsum.photos/300/200?random=116'),

  -- 张杰的演唱会
  ('张杰', '曜·北斗巡回演唱会 - 深圳站', '2024-08-25', '深圳湾体育中心', 'https://picsum.photos/300/200?random=117'),
  ('张杰', '曜·北斗巡回演唱会 - 武汉站', '2024-09-12', '武汉体育中心', 'https://picsum.photos/300/200?random=118'),

  -- 陈奕迅的演唱会
  ('陈奕迅', 'FEAR AND DREAMS 世界巡回 - 香港站', '2024-12-01', '香港红磡体育馆', 'https://picsum.photos/300/200?random=119'),
  ('陈奕迅', 'FEAR AND DREAMS 世界巡回 - 上海站', '2024-12-10', '上海梅赛德斯奔驰文化中心', 'https://picsum.photos/300/200?random=120'),

  -- 蔡依林的演唱会
  ('蔡依林', 'Ugly Beauty 世界巡回 - 台北站', '2024-11-15', '台北小巨蛋', 'https://picsum.photos/300/200?random=121'),
  ('蔡依林', 'Ugly Beauty 世界巡回 - 高雄站', '2024-11-25', '高雄巨蛋', 'https://picsum.photos/300/200?random=122'),

  -- Taylor Swift的演唱会
  ('Taylor Swift', 'The Eras Tour - 东京站', '2024-11-05', '东京巨蛋', 'https://picsum.photos/300/200?random=123'),
  ('Taylor Swift', 'The Eras Tour - 新加坡站', '2024-11-20', '新加坡国家体育场', 'https://picsum.photos/300/200?random=124')
) AS concert_data(singer_name, title, date, venue, poster)
ON s.name = concert_data.singer_name;

-- 4. 插入投票数据
WITH concert_info AS (
  SELECT id, title FROM concerts
)
INSERT INTO votes (concert_id, rating, vote_time)
SELECT 
  ci.id,
  vote_data.rating,
  vote_data.vote_time::TIMESTAMPTZ
FROM concert_info ci
JOIN (
  VALUES
  -- 周杰伦上海站投票数据
  ('2024 嘉年华世界巡回演唱会 - 上海站', 5, '2024-08-16 19:30:00+08'),
  ('2024 嘉年华世界巡回演唱会 - 上海站', 4, '2024-08-16 20:15:00+08'),
  ('2024 嘉年华世界巡回演唱会 - 上海站', 5, '2024-08-16 21:00:00+08'),
  ('2024 嘉年华世界巡回演唱会 - 上海站', 4, '2024-08-17 10:30:00+08'),
  ('2024 嘉年华世界巡回演唱会 - 上海站', 3, '2024-08-17 11:45:00+08'),
  ('2024 嘉年华世界巡回演唱会 - 上海站', 5, '2024-08-17 14:20:00+08'),
  ('2024 嘉年华世界巡回演唱会 - 上海站', 4, '2024-08-18 09:15:00+08'),
  ('2024 嘉年华世界巡回演唱会 - 上海站', 5, '2024-08-18 16:30:00+08'),
  ('2024 嘉年华世界巡回演唱会 - 上海站', 4, '2024-08-19 13:45:00+08'),
  ('2024 嘉年华世界巡回演唱会 - 上海站', 5, '2024-08-20 18:20:00+08'),

  -- 周杰伦北京站投票数据
  ('2024 嘉年华世界巡回演唱会 - 北京站', 4, '2024-09-21 20:00:00+08'),
  ('2024 嘉年华世界巡回演唱会 - 北京站', 3, '2024-09-21 21:30:00+08'),
  ('2024 嘉年华世界巡回演唱会 - 北京站', 5, '2024-09-22 10:15:00+08'),
  ('2024 嘉年华世界巡回演唱会 - 北京站', 4, '2024-09-22 15:45:00+08'),
  ('2024 嘉年华世界巡回演唱会 - 北京站', 4, '2024-09-23 12:30:00+08'),
  ('2024 嘉年华世界巡回演唱会 - 北京站', 3, '2024-09-23 17:20:00+08'),
  ('2024 嘉年华世界巡回演唱会 - 北京站', 5, '2024-09-24 14:10:00+08'),

  -- 林俊杰深圳站投票数据
  ('JJ20 世界巡回演唱会 - 深圳站', 5, '2024-10-06 19:45:00+08'),
  ('JJ20 世界巡回演唱会 - 深圳站', 5, '2024-10-06 20:30:00+08'),
  ('JJ20 世界巡回演唱会 - 深圳站', 4, '2024-10-07 11:20:00+08'),
  ('JJ20 世界巡回演唱会 - 深圳站', 5, '2024-10-07 16:15:00+08'),
  ('JJ20 世界巡回演唱会 - 深圳站', 4, '2024-10-08 13:40:00+08'),
  ('JJ20 世界巡回演唱会 - 深圳站', 5, '2024-10-08 18:25:00+08'),
  ('JJ20 世界巡回演唱会 - 深圳站', 5, '2024-10-09 10:50:00+08'),
  ('JJ20 世界巡回演唱会 - 深圳站', 4, '2024-10-09 15:35:00+08'),

  -- 五月天上海站投票数据
  ('好好好想见到你 - 上海站', 4, '2024-11-11 20:10:00+08'),
  ('好好好想见到你 - 上海站', 3, '2024-11-11 21:45:00+08'),
  ('好好好想见到你 - 上海站', 4, '2024-11-12 12:30:00+08'),
  ('好好好想见到你 - 上海站', 5, '2024-11-12 17:15:00+08'),
  ('好好好想见到你 - 上海站', 4, '2024-11-13 14:20:00+08'),
  ('好好好想见到你 - 上海站', 3, '2024-11-13 19:05:00+08'),
  ('好好好想见到你 - 上海站', 4, '2024-11-14 10:40:00+08'),

  -- 邓紫棋广州站投票数据
  ('Queen of Hearts 世界巡回 - 广州站', 5, '2024-12-16 19:20:00+08'),
  ('Queen of Hearts 世界巡回 - 广州站', 4, '2024-12-16 20:55:00+08'),
  ('Queen of Hearts 世界巡回 - 广州站', 5, '2024-12-17 11:30:00+08'),
  ('Queen of Hearts 世界巡回 - 广州站', 4, '2024-12-17 16:45:00+08'),
  ('Queen of Hearts 世界巡回 - 广州站', 3, '2024-12-18 13:15:00+08'),
  ('Queen of Hearts 世界巡回 - 广州站', 4, '2024-12-18 18:30:00+08'),

  -- 薛之谦上海站投票数据
  ('天外来物巡回演唱会 - 上海站', 4, '2024-09-02 20:25:00+08'),
  ('天外来物巡回演唱会 - 上海站', 3, '2024-09-02 21:50:00+08'),
  ('天外来物巡回演唱会 - 上海站', 4, '2024-09-03 12:35:00+08'),
  ('天外来物巡回演唱会 - 上海站', 5, '2024-09-03 17:20:00+08'),
  ('天外来物巡回演唱会 - 上海站', 4, '2024-09-04 14:45:00+08'),

  -- 华晨宇上海站投票数据
  ('火星演唱会 - 上海站', 5, '2024-10-21 19:35:00+08'),
  ('火星演唱会 - 上海站', 5, '2024-10-21 21:10:00+08'),
  ('火星演唱会 - 上海站', 4, '2024-10-22 11:55:00+08'),
  ('火星演唱会 - 上海站', 5, '2024-10-22 16:40:00+08'),
  ('火星演唱会 - 上海站', 4, '2024-10-23 13:25:00+08'),
  ('火星演唱会 - 上海站', 5, '2024-10-23 18:50:00+08'),

  -- 张杰深圳站投票数据
  ('曜·北斗巡回演唱会 - 深圳站', 4, '2024-08-26 20:15:00+08'),
  ('曜·北斗巡回演唱会 - 深圳站', 3, '2024-08-26 21:40:00+08'),
  ('曜·北斗巡回演唱会 - 深圳站', 4, '2024-08-27 12:25:00+08'),
  ('曜·北斗巡回演唱会 - 深圳站', 5, '2024-08-27 17:10:00+08'),
  ('曜·北斗巡回演唱会 - 深圳站', 4, '2024-08-28 14:35:00+08'),

  -- 陈奕迅香港站投票数据
  ('FEAR AND DREAMS 世界巡回 - 香港站', 5, '2024-12-02 19:45:00+08'),
  ('FEAR AND DREAMS 世界巡回 - 香港站', 4, '2024-12-02 21:20:00+08'),
  ('FEAR AND DREAMS 世界巡回 - 香港站', 5, '2024-12-03 11:05:00+08'),
  ('FEAR AND DREAMS 世界巡回 - 香港站', 4, '2024-12-03 16:30:00+08'),
  ('FEAR AND DREAMS 世界巡回 - 香港站', 5, '2024-12-04 13:15:00+08'),

  -- 蔡依林台北站投票数据
  ('Ugly Beauty 世界巡回 - 台北站', 4, '2024-11-16 20:05:00+08'),
  ('Ugly Beauty 世界巡回 - 台北站', 3, '2024-11-16 21:30:00+08'),
  ('Ugly Beauty 世界巡回 - 台北站', 4, '2024-11-17 12:15:00+08'),
  ('Ugly Beauty 世界巡回 - 台北站', 5, '2024-11-17 17:40:00+08'),
  ('Ugly Beauty 世界巡回 - 台北站', 4, '2024-11-18 14:25:00+08'),

  -- Taylor Swift东京站投票数据
  ('The Eras Tour - 东京站', 5, '2024-11-06 19:25:00+09'),
  ('The Eras Tour - 东京站', 5, '2024-11-06 21:00:00+09'),
  ('The Eras Tour - 东京站', 4, '2024-11-07 10:45:00+09'),
  ('The Eras Tour - 东京站', 5, '2024-11-07 15:30:00+09'),
  ('The Eras Tour - 东京站', 4, '2024-11-08 12:55:00+09'),
  ('The Eras Tour - 东京站', 5, '2024-11-08 17:20:00+09')
) AS vote_data(concert_title, rating, vote_time)
ON ci.title = vote_data.concert_title;

-- 5. 数据验证查询（可选）
-- 查询歌手数量
SELECT '歌手总数: ' || COUNT(*)::text FROM singers;

-- 查询演唱会数量
SELECT '演唱会总数: ' || COUNT(*)::text FROM concerts;

-- 查询投票总数
SELECT '投票总数: ' || COUNT(*)::text FROM votes;

-- 查询每个歌手的平均评分
SELECT 
    s.name AS 歌手,
    s.genre AS 曲风,
    COUNT(DISTINCT c.id) AS 演唱会数量,
    COUNT(v.id) AS 投票数量,
    ROUND(AVG(v.rating), 2) AS 平均评分
FROM singers s
LEFT JOIN concerts c ON s.id = c.singer_id
LEFT JOIN votes v ON c.id = v.concert_id
GROUP BY s.id, s.name, s.genre
ORDER BY COUNT(v.id) DESC, AVG(v.rating) DESC;

-- 查询最受欢迎的演唱会
SELECT 
    c.title AS 演唱会名称,
    s.name AS 歌手,
    COUNT(v.id) AS 投票数量,
    ROUND(AVG(v.rating), 2) AS 平均评分
FROM concerts c
JOIN singers s ON c.singer_id = s.id
LEFT JOIN votes v ON c.id = v.concert_id
GROUP BY c.id, c.title, s.name
ORDER BY COUNT(v.id) DESC, AVG(v.rating) DESC
LIMIT 10;